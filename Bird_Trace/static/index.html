<!doctype html>
<html lang="vi">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dự đoán đường chim bay</title>
  <link rel="stylesheet" href="/static/styles.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
</head>

<body>
  <div class="app" id="appRoot">
    <header class="topbar">
      <div class="brand">
        <div class="brandTitle">
          <span class="brandMark"></span>
          Dự đoán đường chim bay
        </div>
        <div class="brandSub">
          Chọn thời gian bất kỳ • Hệ thống tự lấy 48h lịch sử và dự đoán 24h tiếp theo
        </div>
      </div>

      <div class="topActions">
        <div class="status" id="statusBadge">Đang tải…</div>
        <button id="btnTogglePanel" class="btnIcon" type="button" aria-label="Mở/đóng bảng điều khiển">
          <span class="iconLines" aria-hidden="true"></span>
        </button>
      </div>
    </header>

    <main class="layout">
      <aside class="panel" id="sidePanel">
        <section class="card">
          <div class="cardHeader">
            <h2>Thiết lập</h2>
            <div class="hint">Dữ liệu được tải tự động</div>
          </div>

          <div class="formGrid">
            <div class="formRow">
              <label for="dtInput">Thời gian</label>
              <input id="dtInput" type="datetime-local" />
              <div class="fieldHint">Bạn có thể chọn phút; hệ thống tự xử lý bên trong.</div>
            </div>

            <div class="formRow">
              <label for="modelSelect">Model</label>
              <select id="modelSelect"></select>
            </div>

            <div class="btnRow">
              <button id="btnPredict" class="btnPrimary" type="button">
                <span class="btnSpinner" id="predictSpinner" aria-hidden="true"></span>
                Predict
              </button>
              <a id="btnDownloadXlsx" class="linkBtn" href="#" target="_blank" rel="noreferrer"
                style="display:none;">Tải Excel</a>
              <a id="btnDownload" class="linkBtn" href="#" target="_blank" rel="noreferrer" style="display:none;">Tải
                CSV</a>
            </div>

            <div class="metaLine" id="datasetInfo"></div>
          </div>
        </section>

        <section class="card">
          <div class="cardHeader">
            <h2>Playback</h2>
            <div class="hint">Marker chạy liên tục theo đường đi</div>
          </div>

          <div class="formRow">
            <label for="speedRange">Tốc độ</label>
            <div class="rangeRow">
              <input id="speedRange" type="range" min="0.5" max="4" step="0.5" value="1" />
              <div class="chip" id="speedLabel">1x</div>
            </div>
          </div>

          <div class="formRow inline">
            <label class="checkRow">
              <input id="followToggle" type="checkbox" checked />
              <span>Tự bám theo marker</span>
            </label>
          </div>

          <div class="btnRow">
            <button id="btnPlay" class="btnSecondary" type="button" disabled>Play</button>
            <button id="btnPause" class="btnGhost" type="button" disabled>Pause</button>
            <button id="btnResetView" class="btnTertiary" type="button" disabled>Reset view</button>
          </div>
        </section>

        <section class="card" id="cardKpi">
          <div class="cardHeader">
            <h2>Kết quả nhanh</h2>
            <div class="headerRight">
              <div class="hint">Tóm tắt dự đoán 24h</div>
              <button id="btnToggleKpi" class="btnMini" type="button" aria-label="Thu gọn/mở rộng kết quả nhanh"
                title="Thu gọn/mở rộng">
                <span class="caret" aria-hidden="true"></span>
              </button>
            </div>
          </div>

          <div class="kpiGrid">
            <div class="kpi">
              <div class="kpiLabel">Model</div>
              <div class="kpiValue" id="kpiModel">—</div>
            </div>
            <div class="kpi">
              <div class="kpiLabel">Điểm lịch sử</div>
              <div class="kpiValue" id="kpiHistPts">—</div>
            </div>
            <div class="kpi">
              <div class="kpiLabel">Điểm dự đoán</div>
              <div class="kpiValue" id="kpiPredPts">—</div>
            </div>
            <div class="kpi">
              <div class="kpiLabel">Tổng quãng đường</div>
              <div class="kpiValue" id="kpiTotalDist">—</div>
            </div>
            <div class="kpi">
              <div class="kpiLabel">TB mỗi bước</div>
              <div class="kpiValue" id="kpiAvgStep">—</div>
            </div>
          </div>

          <div class="legendMini">
            <span class="legendPill"><span class="dot hist"></span>Lịch sử</span>
            <span class="legendPill"><span class="dot pred"></span>Dự đoán</span>
          </div>
        </section>
      </aside>

      <section class="mapWrap">
        <div id="map"></div>

        <div class="mapOverlay">
          <div class="nowBox" id="nowBox">
            <div class="nowTitle">Marker</div>
            <div class="nowLine" id="nowLine">—</div>
          </div>

          <div class="mapHint">
            <div class="mapHintTitle">Mẹo</div>
            <div class="mapHintBody">Di chuột lên datapoint để xem <b>timestamp</b>, <b>lat</b>, <b>lon</b>.</div>
          </div>
        </div>
      </section>
    </main>

    <section class="bottomDock">
      <section class="card">
        <div class="tabs">
          <button id="tabNotes" class="tab active" type="button">Ghi chú</button>
          <button id="tabTable" class="tab" type="button">Dữ liệu dự đoán</button>
        </div>

        <div id="panelNotes" class="tabPanel">
          <div class="notes" id="notes"></div>
        </div>

        <div id="panelTable" class="tabPanel hidden">
          <div class="tableWrap">
            <table id="predTable">
              <thead>
                <tr>
                  <th>timestamp</th>
                  <th>x_m</th>
                  <th>y_m</th>
                  <th>lat</th>
                  <th>lon</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>
    </section>


    <div class="toastHost" id="toastHost" aria-live="polite" aria-atomic="true"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="/static/app.js"></script>
</body>

</html>